(function(){var r=$G("J_title"),s=$G("J_titleCol"),m=$G("J_caption"),q=$G("J_sorttable"),k=$G("J_autoSizeContent"),l=$G("J_autoSizePage"),t=$G("J_tone"),o,p=$G("J_preview");var n=function(){o=this;o.init()};n.prototype={init:function(){var a=new UE.ui.ColorPicker({editor:editor}),b=new UE.ui.Popup({editor:editor,content:a});r.checked=editor.queryCommandState("inserttitle")==-1;s.checked=editor.queryCommandState("inserttitlecol")==-1;m.checked=editor.queryCommandState("insertcaption")==-1;q.checked=editor.queryCommandState("enablesort")==1;var d=editor.queryCommandState("enablesort"),c=editor.queryCommandState("disablesort");q.checked=!!(d<0&&c>=0);q.disabled=!!(d<0&&c<0);q.title=d<0&&c<0?lang.errorMsg:"";o.createTable(r.checked,s.checked,m.checked);o.setAutoSize();o.setColor(o.getColor());domUtils.on(r,"click",o.titleHanler);domUtils.on(s,"click",o.titleColHanler);domUtils.on(m,"click",o.captionHanler);domUtils.on(q,"click",o.sorttableHanler);domUtils.on(k,"click",o.autoSizeContentHanler);domUtils.on(l,"click",o.autoSizePageHanler);domUtils.on(t,"click",function(){b.showAnchor(t)});domUtils.on(document,"mousedown",function(){b.hide()});a.addListener("pickcolor",function(){o.setColor(arguments[1]);b.hide()});a.addListener("picknocolor",function(){o.setColor("");b.hide()})},createTable:function(c,d,b){var a=[],h="<span>^</span>";a.push("<table id='J_example'>");if(b){a.push("<caption>"+lang.captionName+"</caption>")}if(c){a.push("<tr>");if(d){a.push("<th>"+lang.titleName+"</th>")}for(var f=0;f<5;f++){a.push("<th>"+lang.titleName+"</th>")}a.push("</tr>")}for(var e=0;e<6;e++){a.push("<tr>");if(d){a.push("<th>"+lang.titleName+"</th>")}for(var g=0;g<5;g++){a.push("<td>"+lang.cellsName+"</td>")}a.push("</tr>")}a.push("</table>");p.innerHTML=a.join("");this.updateSortSpan()},titleHanler:function(){var c=$G("J_example"),d=document.createDocumentFragment(),b=domUtils.getComputedStyle(domUtils.getElementsByTagName(c,"td")[0],"border-color"),a=c.rows[0].children.length;if(r.checked){c.insertRow(0);for(var e=0,f;e<a;e++){f=document.createElement("th");f.innerHTML=lang.titleName;d.appendChild(f)}c.rows[0].appendChild(d)}else{domUtils.remove(c.rows[0])}o.setColor(b);o.updateSortSpan()},titleColHanler:function(){var d=$G("J_example"),c=domUtils.getComputedStyle(domUtils.getElementsByTagName(d,"td")[0],"border-color"),a=d.rows,b=a.length;if(s.checked){for(var e=0,f;e<b;e++){f=document.createElement("th");f.innerHTML=lang.titleName;a[e].insertBefore(f,a[e].children[0])}}else{for(var e=0;e<b;e++){domUtils.remove(a[e].children[0])}}o.setColor(c);o.updateSortSpan()},captionHanler:function(){var a=$G("J_example");if(m.checked){var b=document.createElement("caption");b.innerHTML=lang.captionName;a.insertBefore(b,a.firstChild)}else{domUtils.remove(domUtils.getElementsByTagName(a,"caption")[0])}},sorttableHanler:function(){o.updateSortSpan()},autoSizeContentHanler:function(){var a=$G("J_example");a.removeAttribute("width")},autoSizePageHanler:function(){var a=$G("J_example");var b=a.getElementsByTagName(a,"td");utils.each(b,function(c){c.removeAttribute("width")});a.setAttribute("width","100%")},updateSortSpan:function(){var a=$G("J_example"),b=a.rows[0];var c=domUtils.getElementsByTagName(a,"span");utils.each(c,function(d){d.parentNode.removeChild(d)});if(q.checked){utils.each(b.cells,function(d,e){var f=document.createElement("span");f.innerHTML="^";d.appendChild(f)})}},getColor:function(){var c=editor.selection.getStart(),b,a=domUtils.findParentByTagName(c,["td","th","caption"],true);b=a&&domUtils.getComputedStyle(a,"border-color");if(!b){b="#DDDDDD"}return b},setColor:function(b){var c=$G("J_example"),a=domUtils.getElementsByTagName(c,"td").concat(domUtils.getElementsByTagName(c,"th"),domUtils.getElementsByTagName(c,"caption"));t.value=b;utils.each(a,function(d){d.style.borderColor=b})},setAutoSize:function(){var a=this;l.checked=true;a.autoSizePageHanler()}};new n;dialog.onok=function(){editor.__hasEnterExecCommand=true;var a={title:"inserttitle deletetitle",titleCol:"inserttitlecol deletetitlecol",caption:"insertcaption deletecaption",sorttable:"enablesort disablesort"};editor.fireEvent("saveScene");for(var c in a){var b=a[c].split(" "),d=$G("J_"+c);if(d.checked){editor.queryCommandState(b[0])!=-1&&editor.execCommand(b[0])}else{editor.queryCommandState(b[1])!=-1&&editor.execCommand(b[1])}}editor.execCommand("edittable",t.value);k.checked?editor.execCommand("adaptbytext"):"";l.checked?editor.execCommand("adaptbywindow"):"";editor.fireEvent("saveScene");editor.__hasEnterExecCommand=false}})();