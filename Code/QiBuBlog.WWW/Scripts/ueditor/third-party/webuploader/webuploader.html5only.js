/* WebUploader 0.1.2 */
(function(i,e){var g={},b=function(m,l){var k,o,n;if(typeof m==="string"){return f(m)}else{k=[];for(o=m.length,n=0;n<o;n++){k.push(f(m[n]))}return l.apply(null,k)}},a=function(m,k,l){if(arguments.length===2){l=k;k=null}b(k||[],function(){j(m,l,arguments)})},j=function(m,l,k){var n={exports:l},o;if(typeof l==="function"){k.length||(k=[b,n.exports,n]);o=l.apply(null,k);o!==undefined&&(n.exports=o)}g[m]=n.exports},f=function(k){var l=g[k]||i[k];if(!l){throw new Error("`"+k+"` is undefined")}return l},d=function(n){var l,k,p,o,m,q;q=function(r){return r&&(r.charAt(0).toUpperCase()+r.substr(1))};for(l in g){k=n;if(!g.hasOwnProperty(l)){continue}p=l.split("/");m=q(p.pop());while((o=q(p.shift()))){k[o]=k[o]||{};k=k[o]}k[m]=g[l]}},c=e(i,a,b),h;d(c);if(typeof module==="object"&&typeof module.exports==="object"){module.exports=c}else{if(typeof define==="function"&&define.amd){define([],c)}else{h=i.WebUploader;i.WebUploader=c;i.WebUploader.noConflict=function(){i.WebUploader=h}}}})(this,function(c,a,b){a("dollar-third",[],function(){return c.jQuery||c.Zepto});a("dollar",["dollar-third"],function(d){return d});a("promise-third",["dollar"],function(d){return{Deferred:d.Deferred,when:d.when,isPromise:function(e){return e&&typeof e.then==="function"}}});a("promise",["promise-third"],function(d){return d});a("base",["dollar","promise"],function(d,i){var h=function(){},f=Function.call;function j(k){return function(){return f.apply(k,arguments)}}function e(l,k){return function(){return l.apply(k,arguments)}}function g(l){var k;if(Object.create){return Object.create(l)}else{k=function(){};k.prototype=l;return new k()}}return{version:"0.1.2",$:d,Deferred:i.Deferred,isPromise:i.isPromise,when:i.when,browser:(function(q){var o={},r=q.match(/WebKit\/([\d.]+)/),k=q.match(/Chrome\/([\d.]+)/)||q.match(/CriOS\/([\d.]+)/),m=q.match(/MSIE\s([\d\.]+)/)||q.match(/(?:trident)(?:.*rv:([\w.]+))?/i),l=q.match(/Firefox\/([\d.]+)/),p=q.match(/Safari\/([\d.]+)/),n=q.match(/OPR\/([\d.]+)/);r&&(o.webkit=parseFloat(r[1]));k&&(o.chrome=parseFloat(k[1]));m&&(o.ie=parseFloat(m[1]));l&&(o.firefox=parseFloat(l[1]));p&&(o.safari=parseFloat(p[1]));n&&(o.opera=parseFloat(n[1]));return o})(navigator.userAgent),os:(function(n){var m={},k=n.match(/(?:Android);?[\s\/]+([\d.]+)?/),l=n.match(/(?:iPad|iPod|iPhone).*OS\s([\d_]+)/);k&&(m.android=parseFloat(k[1]));l&&(m.ios=parseFloat(l[1].replace(/_/g,".")));return m})(navigator.userAgent),inherits:function(n,l,m){var k;if(typeof l==="function"){k=l;l=null}else{if(l&&l.hasOwnProperty("constructor")){k=l.constructor}else{k=function(){return n.apply(this,arguments)}}}d.extend(true,k,n,m||{});k.__super__=n.prototype;k.prototype=g(n.prototype);l&&d.extend(true,k.prototype,l);return k},noop:h,bindFn:e,log:(function(){if(c.console){return e(console.log,console)}return h})(),nextTick:(function(){return function(k){setTimeout(k,1)}})(),slice:j([].slice),guid:(function(){var k=0;return function(n){var l=(+new Date()).toString(32),m=0;for(;m<5;m++){l+=Math.floor(Math.random()*65535).toString(32)}return(n||"wu_")+l+(k++).toString(32)}})(),formatSize:function(l,k,n){var m;n=n||["B","K","M","G","TB"];while((m=n.shift())&&l>1024){l=l/1024}return(m==="B"?l:l.toFixed(k||2))+m}}});a("mediator",["base"],function(e){var d=e.$,j=[].slice,i=/\s+/,h;function g(l,o,m,n){return d.grep(l,function(p){return p&&(!o||p.e===o)&&(!m||p.cb===m||p.cb._cb===m)&&(!n||p.ctx===n)})}function f(m,l,n){d.each((m||"").split(i),function(o,p){n(p,l)})}function k(m,l){var q=false,o=-1,p=m.length,n;while(++o<p){n=m[o];if(n.cb.apply(n.ctx2,l)===false){q=true;break}}return !q}h={on:function(o,l,m){var n=this,p;if(!l){return this}p=this._events||(this._events=[]);f(o,l,function(s,q){var r={e:s};r.cb=q;r.ctx=m;r.ctx2=m||n;r.id=p.length;p.push(r)});return this},once:function(o,l,m){var n=this;if(!l){return n}f(o,l,function(q,p){var r=function(){n.off(q,r);return p.apply(m||n,arguments)};r._cb=p;n.on(q,r,m)});return n},off:function(o,l,m){var n=this._events;if(!n){return this}if(!o&&!l&&!m){this._events=[];return this}f(o,l,function(q,p){d.each(g(n,q,p,m),function(){delete n[this.id]})});return this},trigger:function(o){var m,n,l;if(!this._events||!o){return this}m=j.call(arguments,1);n=g(this._events,o);l=g(this._events,"all");return k(n,m)&&k(l,arguments)}};return d.extend({installTo:function(l){return d.extend(l,h)}},h)});a("uploader",["base","mediator"],function(e,f){var d=e.$;function g(h){this.options=d.extend(true,{},g.options,h);this._init(this.options)}g.options={};f.installTo(g.prototype);d.each({upload:"start-upload",stop:"stop-upload",getFile:"get-file",getFiles:"get-files",addFile:"add-file",addFiles:"add-file",sort:"sort-files",removeFile:"remove-file",skipFile:"skip-file",retry:"retry",isInProgress:"is-in-progress",makeThumb:"make-thumb",getDimension:"get-dimension",addButton:"add-btn",getRuntimeType:"get-runtime-type",refresh:"refresh",disable:"disable",enable:"enable",reset:"reset"},function(i,h){g.prototype[i]=function(){return this.request(h,arguments)}});d.extend(g.prototype,{state:"pending",_init:function(i){var h=this;h.request("init",i,function(){h.state="ready";h.trigger("ready")})},option:function(h,j){var i=this.options;if(arguments.length>1){if(d.isPlainObject(j)&&d.isPlainObject(i[h])){d.extend(i[h],j)}else{i[h]=j}}else{return h?i[h]:i}},getStats:function(){var h=this.request("get-stats");return{successNum:h.numOfSuccess,cancelNum:h.numOfCancel,invalidNum:h.numOfInvalid,uploadFailNum:h.numOfUploadFailed,queueNum:h.numOfQueue}},trigger:function(k){var h=[].slice.call(arguments,1),j=this.options,i="on"+k.substring(0,1).toUpperCase()+k.substring(1);if(f.trigger.apply(this,arguments)===false||d.isFunction(j[i])&&j[i].apply(this,h)===false||d.isFunction(this[i])&&this[i].apply(this,h)===false||f.trigger.apply(f,[this,k].concat(h))===false){return false}return true},request:e.noop});e.create=g.create=function(h){return new g(h)};e.Uploader=g;return g});a("runtime/runtime",["base","mediator"],function(e,h){var d=e.$,f={},g=function(k){for(var j in k){if(k.hasOwnProperty(j)){return j}}return null};function i(j){this.options=d.extend({container:document.body},j);this.uid=e.guid("rt_")}d.extend(i.prototype,{getContainer:function(){var k=this.options,l,j;if(this._container){return this._container}l=d(k.container||document.body);j=d(document.createElement("div"));j.attr("id","rt_"+this.uid);j.css({position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"});l.append(j);l.addClass("webuploader-container");this._container=j;return j},init:e.noop,exec:e.noop,destroy:function(){if(this._container){this._container.parentNode.removeChild(this.__container)}this.off()}});i.orders="html5,flash";i.addRuntime=function(k,j){f[k]=j};i.hasRuntime=function(j){return !!(j?f[j]:g(f))};i.create=function(j,k){var m,l;k=k||i.orders;d.each(k.split(/\s*,\s*/g),function(){if(f[this]){m=this;return false}});m=m||g(f);if(!m){throw new Error("Runtime Error")}l=new f[m](j);return l};h.installTo(i.prototype);return i});a("runtime/client",["base","mediator","runtime/runtime"],function(d,f,g){var e;e=(function(){var i={};return{add:function(j){i[j.uid]=j},get:function(k,l){var j;if(k){return i[k]}for(j in i){if(l&&i[j].__standalone){continue}return i[j]}return null},remove:function(j){delete i[j.uid]}}})();function h(i,l){var j=d.Deferred(),k;this.uid=d.guid("client_");this.runtimeReady=function(m){return j.done(m)};this.connectRuntime=function(n,m){if(k){throw new Error("already connected!")}j.done(m);if(typeof n==="string"&&e.get(n)){k=e.get(n)}k=k||e.get(null,l);if(!k){k=g.create(n,n.runtimeOrder);k.__promise=j.promise();k.once("ready",j.resolve);k.init();e.add(k);k.__client=1}else{d.$.extend(k.options,n);k.__promise.then(j.resolve);k.__client++}l&&(k.__standalone=l);return k};this.getRuntime=function(){return k};this.disconnectRuntime=function(){if(!k){return}k.__client--;if(k.__client<=0){e.remove(k);delete k.__promise;k.destroy()}k=null};this.exec=function(){if(!k){return}var m=d.slice(arguments);i&&m.unshift(i);return k.exec.apply(this,m)};this.getRuid=function(){return k&&k.uid};this.destroy=(function(m){return function(){m&&m.apply(this,arguments);this.trigger("destroy");this.off();this.exec("destroy");this.disconnectRuntime()}})(this.destroy)}f.installTo(h.prototype);return h});a("lib/dnd",["base","mediator","runtime/client"],function(e,g,h){var d=e.$;function f(i){i=this.options=d.extend({},f.options,i);i.container=d(i.container);if(!i.container.length){return}h.call(this,"DragAndDrop")}f.options={accept:null,disableGlobalDnd:false};e.inherits(h,{constructor:f,init:function(){var i=this;i.connectRuntime(i.options,function(){i.exec("init");i.trigger("ready")})},destroy:function(){this.disconnectRuntime()}});g.installTo(f.prototype);return f});a("widgets/widget",["base","uploader"],function(f,i){var d=f.$,e=i.prototype._init,g={},k=[];function h(m){if(!m){return false}var l=m.length,n=d.type(m);if(m.nodeType===1&&l){return true}return n==="array"||n!=="function"&&n!=="string"&&(l===0||typeof l==="number"&&l>0&&(l-1) in m)}function j(l){this.owner=l;this.options=l.options}d.extend(j.prototype,{init:f.noop,invoke:function(l,m){var n=this.responseMap;if(!n||!(l in n)||!(n[l] in this)||!d.isFunction(this[n[l]])){return g}return this[n[l]].apply(this,m)},request:function(){return this.owner.request.apply(this.owner,arguments)}});d.extend(i.prototype,{_init:function(){var l=this,m=l._widgets=[];d.each(k,function(n,o){m.push(new o(l))});return e.apply(l,arguments)},request:function(l,m,n){var p=0,w=this._widgets,r=w.length,u=[],o=[],v,t,s,q;m=h(m)?m:[m];for(;p<r;p++){v=w[p];t=v.invoke(l,m);if(t!==g){if(f.isPromise(t)){o.push(t)}else{u.push(t)}}}if(n||o.length){s=f.when.apply(f,o);q=s.pipe?"pipe":"then";return s[q](function(){var y=f.Deferred(),x=arguments;setTimeout(function(){y.resolve.apply(y,x)},1);return y.promise()})[q](n||f.noop)}else{return u[0]}}});i.register=j.register=function(n,o){var m={init:"init"},l;if(arguments.length===1){o=n;o.responseMap=m}else{o.responseMap=d.extend(m,n)}l=f.inherits(j,o);k.push(l);return l};return j});a("widgets/filednd",["base","uploader","lib/dnd","widgets/widget"],function(e,g,f){var d=e.$;g.options.dnd="";return g.register({init:function(l){if(!l.dnd||this.request("predict-runtime-type")!=="html5"){return}var j=this,h=e.Deferred(),k=d.extend({},{disableGlobalDnd:l.disableGlobalDnd,container:l.dnd,accept:l.accept}),i;i=new f(k);i.once("ready",h.resolve);i.on("drop",function(m){j.request("add-file",[m])});i.on("accept",function(m){return j.owner.trigger("dndAccept",m)});i.init();return h.promise()}})});a("lib/filepaste",["base","mediator","runtime/client"],function(e,g,h){var d=e.$;function f(i){i=this.options=d.extend({},i);i.container=d(i.container||document.body);h.call(this,"FilePaste")}e.inherits(h,{constructor:f,init:function(){var i=this;i.connectRuntime(i.options,function(){i.exec("init");i.trigger("ready")})},destroy:function(){this.exec("destroy");this.disconnectRuntime();this.off()}});g.installTo(f.prototype);return f});a("widgets/filepaste",["base","uploader","lib/filepaste","widgets/widget"],function(e,g,f){var d=e.$;return g.register({init:function(k){if(!k.paste||this.request("predict-runtime-type")!=="html5"){return}var i=this,h=e.Deferred(),j=d.extend({},{container:k.paste,accept:k.accept}),l;l=new f(j);l.once("ready",h.resolve);l.on("paste",function(m){i.owner.request("add-file",[m])});l.init();return h.promise()}})});a("lib/blob",["base","runtime/client"],function(d,f){function e(h,i){var g=this;g.source=i;g.ruid=h;f.call(g,"Blob");this.uid=i.uid||this.uid;this.type=i.type||"";this.size=i.size||0;if(h){g.connectRuntime(h)}}d.inherits(f,{constructor:e,slice:function(h,g){return this.exec("slice",h,g)},getSource:function(){return this.source}});return e});a("lib/file",["base","lib/blob"],function(d,e){var h=1,g=/\.([^.]+)$/;function f(k,j){var i;e.apply(this,arguments);this.name=j.name||("untitled"+h++);i=g.exec(j.name)?RegExp.$1.toLowerCase():"";if(!i&&this.type){i=/\/(jpg|jpeg|png|gif|bmp)$/i.exec(this.type)?RegExp.$1.toLowerCase():"";this.name+="."+i}if(!this.type&&~"jpg,jpeg,png,gif,bmp".indexOf(i)){this.type="image/"+(i==="jpg"?"jpeg":i)}this.ext=i;this.lastModifiedDate=j.lastModifiedDate||(new Date()).toLocaleString()}return d.inherits(e,f)});a("lib/filepicker",["base","runtime/client","lib/file"],function(e,h,f){var d=e.$;function g(i){i=this.options=d.extend({},g.options,i);i.container=d(i.id);if(!i.container.length){throw new Error("按钮指定错误")}i.innerHTML=i.innerHTML||i.label||i.container.html()||"";i.button=d(i.button||document.createElement("div"));i.button.html(i.innerHTML);i.container.html(i.button);h.call(this,"FilePicker",true)}g.options={button:null,container:null,label:null,innerHTML:null,multiple:true,accept:null,name:"file"};e.inherits(h,{constructor:g,init:function(){var j=this,k=j.options,i=k.button;i.addClass("webuploader-pick");j.on("all",function(m){var l;switch(m){case"mouseenter":i.addClass("webuploader-pick-hover");break;case"mouseleave":i.removeClass("webuploader-pick-hover");break;case"change":l=j.exec("getFiles");j.trigger("select",d.map(l,function(n){n=new f(j.getRuid(),n);n._refer=k.container;return n}),k.container);break}});j.connectRuntime(k,function(){j.refresh();j.exec("init",k);j.trigger("ready")});d(c).on("resize",function(){j.refresh()})},refresh:function(){var l=this.getRuntime().getContainer(),i=this.options.button,m=i.outerWidth?i.outerWidth():i.width(),j=i.outerHeight?i.outerHeight():i.height(),k=i.offset();m&&j&&l.css({bottom:"auto",right:"auto",width:m+"px",height:j+"px"}).offset(k)},enable:function(){var i=this.options.button;i.removeClass("webuploader-pick-disable");this.refresh()},disable:function(){var i=this.options.button;this.getRuntime().getContainer().css({top:"-99999px"});i.addClass("webuploader-pick-disable")},destroy:function(){if(this.runtime){this.exec("destroy");this.disconnectRuntime()}}});return g});a("widgets/filepicker",["base","uploader","lib/filepicker","widgets/widget"],function(e,g,f){var d=e.$;d.extend(g.options,{pick:null,accept:null});return g.register({"add-btn":"addButton",refresh:"refresh",disable:"disable",enable:"enable"},{init:function(h){this.pickers=[];return h.pick&&this.addButton(h.pick)},refresh:function(){d.each(this.pickers,function(){this.refresh()})},addButton:function(m){var j=this,l=j.options,h=l.accept,k,n,i;if(!m){return}i=e.Deferred();d.isPlainObject(m)||(m={id:m});k=d.extend({},m,{accept:d.isPlainObject(h)?[h]:h,swf:l.swf,runtimeOrder:l.runtimeOrder});n=new f(k);n.once("ready",i.resolve);n.on("select",function(o){j.owner.request("add-file",[o])});n.init();this.pickers.push(n);return i.promise()},disable:function(){d.each(this.pickers,function(){this.disable()})},enable:function(){d.each(this.pickers,function(){this.enable()})}})});a("lib/image",["base","runtime/client","lib/blob"],function(e,h,f){var d=e.$;function g(i){this.options=d.extend({},g.options,i);h.call(this,"Image");this.on("load",function(){this._info=this.exec("info");this._meta=this.exec("meta")})}g.options={quality:90,crop:false,preserveHeaders:true,allowMagnify:true};e.inherits(h,{constructor:g,info:function(i){if(i){this._info=i;return this}return this._info},meta:function(i){if(i){this._meta=i;return this}return this._meta},loadFromBlob:function(i){var j=this,k=i.getRuid();this.connectRuntime(k,function(){j.exec("init",j.options);j.exec("loadFromBlob",i)})},resize:function(){var i=e.slice(arguments);return this.exec.apply(this,["resize"].concat(i))},getAsDataUrl:function(i){return this.exec("getAsDataUrl",i)},getAsBlob:function(j){var i=this.exec("getAsBlob",j);return new f(this.getRuid(),i)}});return g});a("widgets/image",["base","uploader","lib/image","widgets/widget"],function(e,h,f){var d=e.$,g;g=(function(i){var j=0,l=[],k=function(){var m;while(l.length&&j<i){m=l.shift();j+=m[0];m[1]()}};return function(n,o,m){l.push([o,m]);n.once("destroy",function(){j-=o;setTimeout(k,1)});setTimeout(k,1)}})(5*1024*1024);d.extend(h.options,{thumb:{width:110,height:110,quality:70,allowMagnify:true,crop:true,preserveHeaders:false,type:"image/jpeg"},compress:{width:1600,height:1600,quality:90,allowMagnify:false,crop:false,preserveHeaders:true}});return h.register({"make-thumb":"makeThumb","before-send-file":"compressImage"},{makeThumb:function(j,i,n,k){var m,l;j=this.request("get-file",j);if(!j.type.match(/^image/)){i(true);return}m=d.extend({},this.options.thumb);if(d.isPlainObject(n)){m=d.extend(m,n);n=null}n=n||m.width;k=k||m.height;l=new f(m);l.once("load",function(){j._info=j._info||l.info();j._meta=j._meta||l.meta();l.resize(n,k)});l.once("complete",function(){i(false,l.getAsDataUrl(m.type));l.destroy()});l.once("error",function(){i(true);l.destroy()});g(l,j.source.size,function(){j._info&&l.info(j._info);j._meta&&l.meta(j._meta);l.loadFromBlob(j.source)})},compressImage:function(k){var m=this.options.compress||this.options.resize,i=m&&m.compressSize||300*1024,l,j;k=this.request("get-file",k);if(!m||!~"image/jpeg,image/jpg".indexOf(k.type)||k.size<i||k._compressed){return}m=d.extend({},m);j=e.Deferred();l=new f(m);j.always(function(){l.destroy();l=null});l.once("error",j.reject);l.once("load",function(){k._info=k._info||l.info();k._meta=k._meta||l.meta();l.resize(m.width,m.height)});l.once("complete",function(){var n,p;try{n=l.getAsBlob(m.type);p=k.size;if(n.size<p){k.source=n;k.size=n.size;k.trigger("resize",n.size,p)}k._compressed=true;j.resolve()}catch(o){j.resolve()}});k._info&&l.info(k._info);k._meta&&l.meta(k._meta);l.loadFromBlob(k.source);return j.promise()}})});a("file",["base","mediator"],function(e,i){var d=e.$,g="WU_FILE_",h=0,j=/\.([^.]+)$/,k={};function f(){return g+h++}function l(m){this.name=m.name||"Untitled";this.size=m.size||0;this.type=m.type||"application";this.lastModifiedDate=m.lastModifiedDate||(new Date()*1);this.id=f();this.ext=j.exec(this.name)?RegExp.$1:"";this.statusText="";k[this.id]=l.Status.INITED;this.source=m;this.loaded=0;this.on("error",function(n){this.setStatus(l.Status.ERROR,n)})}d.extend(l.prototype,{setStatus:function(n,o){var m=k[this.id];typeof o!=="undefined"&&(this.statusText=o);if(n!==m){k[this.id]=n;this.trigger("statuschange",n,m)}},getStatus:function(){return k[this.id]},getSource:function(){return this.source},destory:function(){delete k[this.id]}});i.installTo(l.prototype);l.Status={INITED:"inited",QUEUED:"queued",PROGRESS:"progress",ERROR:"error",COMPLETE:"complete",CANCELLED:"cancelled",INTERRUPT:"interrupt",INVALID:"invalid"};return l});a("queue",["base","mediator","file"],function(e,f,i){var d=e.$,h=i.Status;function g(){this.stats={numOfQueue:0,numOfSuccess:0,numOfCancel:0,numOfProgress:0,numOfUploadFailed:0,numOfInvalid:0};this._queue=[];this._map={}}d.extend(g.prototype,{append:function(j){this._queue.push(j);this._fileAdded(j);return this},prepend:function(j){this._queue.unshift(j);this._fileAdded(j);return this},getFile:function(j){if(typeof j!=="string"){return j}return this._map[j]},fetch:function(m){var l=this._queue.length,k,j;m=m||h.QUEUED;for(k=0;k<l;k++){j=this._queue[k];if(m===j.getStatus()){return j}}return null},sort:function(j){if(typeof j==="function"){this._queue.sort(j)}},getFiles:function(){var n=[].slice.call(arguments,0),m=[],k=0,l=this._queue.length,j;for(;k<l;k++){j=this._queue[k];if(n.length&&!~d.inArray(j.getStatus(),n)){continue}m.push(j)}return m},_fileAdded:function(k){var l=this,j=this._map[k.id];if(!j){this._map[k.id]=k;k.on("statuschange",function(m,n){l._onFileStatusChange(m,n)})}k.setStatus(h.QUEUED)},_onFileStatusChange:function(j,k){var l=this.stats;switch(k){case h.PROGRESS:l.numOfProgress--;break;case h.QUEUED:l.numOfQueue--;break;case h.ERROR:l.numOfUploadFailed--;break;case h.INVALID:l.numOfInvalid--;break}switch(j){case h.QUEUED:l.numOfQueue++;break;case h.PROGRESS:l.numOfProgress++;break;case h.ERROR:l.numOfUploadFailed++;break;case h.COMPLETE:l.numOfSuccess++;break;case h.CANCELLED:l.numOfCancel++;break;case h.INVALID:l.numOfInvalid++;break}}});f.installTo(g.prototype);return g});a("widgets/queue",["base","uploader","queue","file","lib/file","runtime/client","widgets/widget"],function(e,k,g,l,f,i){var d=e.$,h=/\.\w+$/,j=l.Status;return k.register({"sort-files":"sortFiles","add-file":"addFiles","get-file":"getFile","fetch-file":"fetchFile","get-stats":"getStats","get-files":"getFiles","remove-file":"removeFile",retry:"retry",reset:"reset","accept-file":"acceptFile"},{init:function(t){var s=this,o,r,p,q,n,m,u;if(d.isPlainObject(t.accept)){t.accept=[t.accept]}if(t.accept){n=[];for(p=0,r=t.accept.length;p<r;p++){q=t.accept[p].extensions;q&&n.push(q)}if(n.length){m="\\."+n.join(",").replace(/,/g,"$|\\.").replace(/\*/g,".*")+"$"}s.accept=new RegExp(m,"i")}s.queue=new g();s.stats=s.queue.stats;if(this.request("predict-runtime-type")!=="html5"){return}o=e.Deferred();u=new i("Placeholder");u.connectRuntime({runtimeOrder:"html5"},function(){s._ruid=u.getRuid();o.resolve()});return o.promise()},_wrapFile:function(m){if(!(m instanceof l)){if(!(m instanceof f)){if(!this._ruid){throw new Error("Can't add external files.")}m=new f(this._ruid,m)}m=new l(m)}return m},acceptFile:function(m){var n=!m||m.size<6||this.accept&&h.exec(m.name)&&!this.accept.test(m.name);return !n},_addFile:function(m){var n=this;m=n._wrapFile(m);if(!n.owner.trigger("beforeFileQueued",m)){return}if(!n.acceptFile(m)){n.owner.trigger("error","Q_TYPE_DENIED",m);return}n.queue.append(m);n.owner.trigger("fileQueued",m);return m},getFile:function(m){return this.queue.getFile(m)},addFiles:function(m){var n=this;if(!m.length){m=[m]}m=d.map(m,function(o){return n._addFile(o)});n.owner.trigger("filesQueued",m);if(n.options.auto){n.request("start-upload")}},getStats:function(){return this.stats},removeFile:function(m){var n=this;m=m.id?m:n.queue.getFile(m);m.setStatus(j.CANCELLED);n.owner.trigger("fileDequeued",m)},getFiles:function(){return this.queue.getFiles.apply(this.queue,arguments)},fetchFile:function(){return this.queue.fetch.apply(this.queue,arguments)},retry:function(m,r){var q=this,n,o,p;if(m){m=m.id?m:q.queue.getFile(m);m.setStatus(j.QUEUED);r||q.request("start-upload");return}n=q.queue.getFiles(j.ERROR);o=0;p=n.length;for(;o<p;o++){m=n[o];m.setStatus(j.QUEUED)}q.request("start-upload")},sortFiles:function(){return this.queue.sort.apply(this.queue,arguments)},reset:function(){this.queue=new g();this.stats=this.queue.stats}})});a("widgets/runtime",["uploader","runtime/runtime","widgets/widget"],function(e,d){e.support=function(){return d.hasRuntime.apply(d,arguments)};return e.register({"predict-runtime-type":"predictRuntmeType"},{init:function(){if(!this.predictRuntmeType()){throw Error("Runtime Error")}},predictRuntmeType:function(){var h=this.options.runtimeOrder||d.orders,j=this.type,f,g;if(!j){h=h.split(/\s*,\s*/g);for(f=0,g=h.length;f<g;f++){if(d.hasRuntime(h[f])){this.type=j=h[f];break}}}return j}})});a("lib/transport",["base","runtime/client","mediator"],function(e,g,f){var d=e.$;function h(j){var i=this;j=i.options=d.extend(true,{},h.options,j||{});g.call(this,"Transport");this._blob=null;this._formData=j.formData||{};this._headers=j.headers||{};this.on("progress",this._timeout);this.on("load error",function(){i.trigger("progress",1);clearTimeout(i._timer)})}h.options={server:"",method:"POST",withCredentials:false,fileVal:"file",timeout:2*60*1000,formData:{},headers:{},sendAsBinary:false};d.extend(h.prototype,{appendBlob:function(k,i,j){var l=this,m=l.options;if(l.getRuid()){l.disconnectRuntime()}l.connectRuntime(i.ruid,function(){l.exec("init")});l._blob=i;m.fileVal=k||m.fileVal;m.filename=j||m.filename},append:function(i,j){if(typeof i==="object"){d.extend(this._formData,i)}else{this._formData[i]=j}},setRequestHeader:function(i,j){if(typeof i==="object"){d.extend(this._headers,i)}else{this._headers[i]=j}},send:function(i){this.exec("send",i);this._timeout()},abort:function(){clearTimeout(this._timer);return this.exec("abort")},destroy:function(){this.trigger("destroy");this.off();this.exec("destroy");this.disconnectRuntime()},getResponse:function(){return this.exec("getResponse")},getResponseAsJson:function(){return this.exec("getResponseAsJson")},getStatus:function(){return this.exec("getStatus")},_timeout:function(){var j=this,i=j.options.timeout;if(!i){return}clearTimeout(j._timer);j._timer=setTimeout(function(){j.abort();j.trigger("error","timeout")},i)}});f.installTo(h.prototype);return h});a("widgets/upload",["base","uploader","file","lib/transport","widgets/widget"],function(e,j,k,i){var d=e.$,g=e.isPromise,h=k.Status;d.extend(j.options,{prepareNextFile:false,chunked:false,chunkSize:5*1024*1024,chunkRetry:2,threads:3,formData:null});function f(o,n){var r=[],l=o.source,t=l.size,m=n?Math.ceil(t/n):1,s=0,p=0,q;while(p<m){q=Math.min(n,t-s);r.push({file:o,start:s,end:n?(s+q):t,total:t,chunks:m,chunk:p++});s+=q}o.blocks=r.concat();o.remaning=r.length;return{file:o,has:function(){return !!r.length},fetch:function(){return r.shift()}}}j.register({"start-upload":"start","stop-upload":"stop","skip-file":"skipFile","is-in-progress":"isInProgress"},{init:function(){var l=this.owner;this.runing=false;this.pool=[];this.pending=[];this.remaning=0;this.__tick=e.bindFn(this._tick,this);l.on("uploadComplete",function(m){m.blocks&&d.each(m.blocks,function(n,o){o.transport&&(o.transport.abort(),o.transport.destroy());delete o.transport});delete m.blocks;delete m.remaning})},start:function(){var l=this;d.each(l.request("get-files",h.INVALID),function(){l.request("remove-file",this)});if(l.runing){return}l.runing=true;d.each(l.pool,function(m,o){var n=o.file;if(n.getStatus()===h.INTERRUPT){n.setStatus(h.PROGRESS);l._trigged=false;o.transport&&o.transport.send()}});l._trigged=false;l.owner.trigger("startUpload");e.nextTick(l.__tick)},stop:function(l){var m=this;if(m.runing===false){return}m.runing=false;l&&d.each(m.pool,function(n,o){o.transport&&o.transport.abort();o.file.setStatus(h.INTERRUPT)});m.owner.trigger("stopUpload")},isInProgress:function(){return !!this.runing},getStats:function(){return this.request("get-stats")},skipFile:function(l,m){l=this.request("get-file",l);l.setStatus(m||h.COMPLETE);l.skipped=true;l.blocks&&d.each(l.blocks,function(n,p){var o=p.transport;if(o){o.abort();o.destroy();delete p.transport}});this.owner.trigger("uploadSkip",l)},_tick:function(){var m=this,n=m.options,l,o;if(m._promise){return m._promise.always(m.__tick)}if(m.pool.length<n.threads&&(o=m._nextBlock())){m._trigged=false;l=function(p){m._promise=null;p&&p.file&&m._startSend(p);e.nextTick(m.__tick)};m._promise=g(o)?o.always(l):l(o)}else{if(!m.remaning&&!m.getStats().numOfQueue){m.runing=false;m._trigged||e.nextTick(function(){m.owner.trigger("uploadFinished")});m._trigged=true}}},_nextBlock:function(){var n=this,l=n._act,p=n.options,o,m;if(l&&l.has()&&l.file.getStatus()===h.PROGRESS){if(p.prepareNextFile&&!n.pending.length){n._prepareNextFile()}return l.fetch()}else{if(n.runing){if(!n.pending.length&&n.getStats().numOfQueue){n._prepareNextFile()}o=n.pending.shift();m=function(q){if(!q){return null}l=f(q,p.chunked?p.chunkSize:0);n._act=l;return l.fetch()};return g(o)?o[o.pipe?"pipe":"then"](m):m(o)}}},_prepareNextFile:function(){var m=this,l=m.request("fetch-file"),n=m.pending,o;if(l){o=m.request("before-send-file",l,function(){if(l.getStatus()===h.QUEUED){m.owner.trigger("uploadStart",l);l.setStatus(h.PROGRESS);return l}return m._finishFile(l)});o.done(function(){var p=d.inArray(o,n);~p&&n.splice(p,1,l)});o.fail(function(p){l.setStatus(h.ERROR,p);m.owner.trigger("uploadError",l,p);m.owner.trigger("uploadComplete",l)});n.push(o)}},_popBlock:function(l){var m=d.inArray(l,this.pool);this.pool.splice(m,1);l.file.remaning--;this.remaning--},_startSend:function(l){var n=this,m=l.file,o;n.pool.push(l);n.remaning++;l.blob=l.chunks===1?m.source:m.source.slice(l.start,l.end);o=n.request("before-send",l,function(){if(m.getStatus()===h.PROGRESS){n._doSend(l)}else{n._popBlock(l);e.nextTick(n.__tick)}});o.fail(function(){if(m.remaning===1){n._finishFile(m).always(function(){l.percentage=1;n._popBlock(l);n.owner.trigger("uploadComplete",m);e.nextTick(n.__tick)})}else{l.percentage=1;n._popBlock(l);e.nextTick(n.__tick)}})},_doSend:function(l){var p=this,r=p.owner,q=p.options,n=l.file,u=new i(q),m=d.extend({},q.formData),o=d.extend({},q.headers),s,t;l.transport=u;u.on("destroy",function(){delete l.transport;p._popBlock(l);e.nextTick(p.__tick)});u.on("progress",function(v){var w=0,x=0;w=l.percentage=v;if(l.chunks>1){d.each(n.blocks,function(y,z){x+=(z.percentage||0)*(z.end-z.start)});w=x/n.size}r.trigger("uploadProgress",n,w||0)});s=function(w){var v;t=u.getResponseAsJson()||{};t._raw=u.getResponse();v=function(x){w=x};if(!r.trigger("uploadAccept",l,t,v)){w=w||"server"}return w};u.on("error",function(w,v){l.retried=l.retried||0;if(l.chunks>1&&~"http,abort".indexOf(w)&&l.retried<q.chunkRetry){l.retried++;u.send()}else{if(!v&&w==="server"){w=s(w)}n.setStatus(h.ERROR,w);r.trigger("uploadError",n,w);r.trigger("uploadComplete",n)}});u.on("load",function(){var v;if((v=s())){u.trigger("error",v,true);return}if(n.remaning===1){p._finishFile(n,t)}else{u.destroy()}});m=d.extend(m,{id:n.id,name:n.name,type:n.type,lastModifiedDate:n.lastModifiedDate,size:n.size});l.chunks>1&&d.extend(m,{chunks:l.chunks,chunk:l.chunk});r.trigger("uploadBeforeSend",l,m,o);u.appendBlob(q.fileVal,l.blob,n.name);u.append(m);u.setRequestHeader(o);u.send()},_finishFile:function(l,o,m){var n=this.owner;return n.request("after-send-file",arguments,function(){l.setStatus(h.COMPLETE);n.trigger("uploadSuccess",l,o,m)}).fail(function(p){if(l.getStatus()===h.PROGRESS){l.setStatus(h.ERROR,p)}n.trigger("uploadError",l,p)}).always(function(){n.trigger("uploadComplete",l)})}})});a("widgets/validator",["base","uploader","file","widgets/widget"],function(f,g,i){var d=f.$,h={},e;e={addValidator:function(k,j){h[k]=j},removeValidator:function(j){delete h[j]}};g.register({init:function(){var j=this;d.each(h,function(){this.call(j.owner)})}});e.addValidator("fileNumLimit",function(){var n=this,m=n.options,j=0,l=m.fileNumLimit>>0,k=true;if(!l){return}n.on("beforeFileQueued",function(o){if(j>=l&&k){k=false;this.trigger("error","Q_EXCEED_NUM_LIMIT",l,o);setTimeout(function(){k=true},1)}return j>=l?false:true});n.on("fileQueued",function(){j++});n.on("fileDequeued",function(){j--});n.on("uploadFinished",function(){j=0})});e.addValidator("fileSizeLimit",function(){var n=this,m=n.options,j=0,l=m.fileSizeLimit>>0,k=true;if(!l){return}n.on("beforeFileQueued",function(o){var p=j+o.size>l;if(p&&k){k=false;this.trigger("error","Q_EXCEED_SIZE_LIMIT",l,o);setTimeout(function(){k=true},1)}return p?false:true});n.on("fileQueued",function(o){j+=o.size});n.on("fileDequeued",function(o){j-=o.size});n.on("uploadFinished",function(){j=0})});e.addValidator("fileSingleSizeLimit",function(){var l=this,k=l.options,j=k.fileSingleSizeLimit;if(!j){return}l.on("beforeFileQueued",function(m){if(m.size>j){m.setStatus(i.Status.INVALID,"exceed_size");this.trigger("error","F_EXCEED_SIZE",m);return false}})});e.addValidator("duplicate",function(){var m=this,l=m.options,k={};if(l.duplicate){return}function j(r){var o=0,p=0,q=r.length,n;for(;p<q;p++){n=r.charCodeAt(p);o=n+(o<<6)+(o<<16)-o}return o}m.on("beforeFileQueued",function(n){var o=n.__hash||(n.__hash=j(n.name+n.size+n.lastModifiedDate));if(k[o]){this.trigger("error","F_DUPLICATE",n);return false}});m.on("fileQueued",function(n){var o=n.__hash;o&&(k[o]=true)});m.on("fileDequeued",function(n){var o=n.__hash;o&&(delete k[o])})});return e});a("runtime/compbase",[],function(){function d(e,f){this.owner=e;this.options=e.options;this.getRuntime=function(){return f};this.getRuid=function(){return f.uid};this.trigger=function(){return e.trigger.apply(e,arguments)}}return d});a("runtime/html5/runtime",["base","runtime/runtime","runtime/compbase"],function(d,h,e){var i="html5",f={};function g(){var l={},k=this,j=this.destory;h.apply(k,arguments);k.type=i;k.exec=function(o,p){var n=this,r=n.uid,m=d.slice(arguments,2),q;if(f[o]){q=l[r]=l[r]||new f[o](n,k);if(q[p]){return q[p].apply(q,m)}}};k.destory=function(){return j&&j.apply(this,arguments)}}d.inherits(h,{constructor:g,init:function(){var j=this;setTimeout(function(){j.trigger("ready")},1)}});g.register=function(l,j){var k=f[l]=d.inherits(e,j);return k};if(c.Blob&&c.FileReader&&c.DataView){h.addRuntime(i,g)}return g});a("runtime/html5/blob",["runtime/html5/runtime","lib/blob"],function(e,d){return e.register("Blob",{slice:function(i,g){var f=this.owner.source,h=f.slice||f.webkitSlice||f.mozSlice;f=h.call(f,i,g);return new d(this.getRuid(),f)}})});a("runtime/html5/dnd",["base","runtime/html5/runtime","lib/file"],function(e,g,f){var d=e.$,h="webuploader-dnd-";return g.register("DragAndDrop",{init:function(){var i=this.elem=this.options.container;this.dragEnterHandler=e.bindFn(this._dragEnterHandler,this);this.dragOverHandler=e.bindFn(this._dragOverHandler,this);this.dragLeaveHandler=e.bindFn(this._dragLeaveHandler,this);this.dropHandler=e.bindFn(this._dropHandler,this);this.dndOver=false;i.on("dragenter",this.dragEnterHandler);i.on("dragover",this.dragOverHandler);i.on("dragleave",this.dragLeaveHandler);i.on("drop",this.dropHandler);if(this.options.disableGlobalDnd){d(document).on("dragover",this.dragOverHandler);d(document).on("drop",this.dropHandler)}},_dragEnterHandler:function(j){var l=this,i=l._denied||false,k;j=j.originalEvent||j;if(!l.dndOver){l.dndOver=true;k=j.dataTransfer.items;if(k&&k.length){l._denied=i=!l.trigger("accept",k)}l.elem.addClass(h+"over");l.elem[i?"addClass":"removeClass"](h+"denied")}j.dataTransfer.dropEffect=i?"none":"copy";return false},_dragOverHandler:function(i){var j=this.elem.parent().get(0);if(j&&!d.contains(j,i.currentTarget)){return false}clearTimeout(this._leaveTimer);this._dragEnterHandler.call(this,i);return false},_dragLeaveHandler:function(){var j=this,i;i=function(){j.dndOver=false;j.elem.removeClass(h+"over "+h+"denied")};clearTimeout(j._leaveTimer);j._leaveTimer=setTimeout(i,100);return false},_dropHandler:function(i){var j=this,l=j.getRuid(),k=j.elem.parent().get(0);if(k&&!d.contains(k,i.currentTarget)){return false}j._getTansferFiles(i,function(m){j.trigger("drop",d.map(m,function(n){return new f(l,n)}))});j.dndOver=false;j.elem.removeClass(h+"over");return false},_getTansferFiles:function(m,j){var u=[],t=[],r,o,l,n,q,p,s,k;m=m.originalEvent||m;l=m.dataTransfer;r=l.items;o=l.files;k=!!(r&&r[0].webkitGetAsEntry);for(p=0,s=o.length;p<s;p++){n=o[p];q=r&&r[p];if(k&&q.webkitGetAsEntry().isDirectory){t.push(this._traverseDirectoryTree(q.webkitGetAsEntry(),u))}else{u.push(n)}}e.when.apply(e,t).done(function(){if(!u.length){return}j(u)})},_traverseDirectoryTree:function(j,l){var i=e.Deferred(),k=this;if(j.isFile){j.file(function(m){l.push(m);i.resolve()})}else{if(j.isDirectory){j.createReader().readEntries(function(n){var p=n.length,q=[],m=[],o;for(o=0;o<p;o++){q.push(k._traverseDirectoryTree(n[o],m))}e.when.apply(e,q).then(function(){l.push.apply(l,m);i.resolve()},i.reject)})}}return i.promise()},destroy:function(){var i=this.elem;i.off("dragenter",this.dragEnterHandler);i.off("dragover",this.dragEnterHandler);i.off("dragleave",this.dragLeaveHandler);i.off("drop",this.dropHandler);if(this.options.disableGlobalDnd){d(document).off("dragover",this.dragOverHandler);d(document).off("drop",this.dropHandler)}}})});a("runtime/html5/filepaste",["base","runtime/html5/runtime","lib/file"],function(d,f,e){return f.register("FilePaste",{init:function(){var n=this.options,j=this.elem=n.container,g=".*",h,k,m,l;if(n.accept){h=[];for(k=0,m=n.accept.length;k<m;k++){l=n.accept[k].mimeTypes;l&&h.push(l)}if(h.length){g=h.join(",");g=g.replace(/,/g,"|").replace(/\*/g,".*")}}this.accept=g=new RegExp(g,"i");this.hander=d.bindFn(this._pasteHander,this);j.on("paste",this.hander)},_pasteHander:function(j){var g=[],o=this.getRuid(),m,l,h,k,n;j=j.originalEvent||j;m=j.clipboardData.items;for(k=0,n=m.length;k<n;k++){l=m[k];if(l.kind!=="file"||!(h=l.getAsFile())){continue}g.push(new e(o,h))}if(g.length){j.preventDefault();j.stopPropagation();this.trigger("paste",g)}},destroy:function(){this.elem.off("paste",this.hander)}})});a("runtime/html5/filepicker",["base","runtime/html5/runtime"],function(e,f){var d=e.$;return f.register("FilePicker",{init:function(){var h=this.getRuntime().getContainer(),n=this,q=n.owner,p=n.options,l=d(document.createElement("label")),k=d(document.createElement("input")),g,j,m,o;k.attr("type","file");k.attr("name",p.name);k.addClass("webuploader-element-invisible");l.on("click",function(){k.trigger("click")});l.css({opacity:0,width:"100%",height:"100%",display:"block",cursor:"pointer",background:"#ffffff"});if(p.multiple){k.attr("multiple","multiple")}if(p.accept&&p.accept.length>0){g=[];for(j=0,m=p.accept.length;j<m;j++){g.push(p.accept[j].mimeTypes)}k.attr("accept",g.join(","))}h.append(k);h.append(l);o=function(i){q.trigger(i.type)};k.on("change",function(r){var s=arguments.callee,i;n.files=r.target.files;i=this.cloneNode(true);this.parentNode.replaceChild(i,this);k.off();k=d(i).on("change",s).on("mouseenter mouseleave",o);q.trigger("change")});l.on("mouseenter mouseleave",o)},getFiles:function(){return this.files},destroy:function(){}})});a("runtime/html5/util",["base"],function(d){var g=c.createObjectURL&&c||c.URL&&URL.revokeObjectURL&&URL||c.webkitURL,e=d.noop,f=e;if(g){e=function(){return g.createObjectURL.apply(g,arguments)};f=function(){return g.revokeObjectURL.apply(g,arguments)}}return{createObjectURL:e,revokeObjectURL:f,dataURL2Blob:function(k){var j,m,h,l,n,o;o=k.split(",");if(~o[0].indexOf("base64")){j=atob(o[1])}else{j=decodeURIComponent(o[1])}h=new ArrayBuffer(j.length);m=new Uint8Array(h);for(l=0;l<j.length;l++){m[l]=j.charCodeAt(l)}n=o[0].split(":")[1].split(";")[0];return this.arrayBufferToBlob(h,n)},dataURL2ArrayBuffer:function(j){var h,l,k,m;m=j.split(",");if(~m[0].indexOf("base64")){h=atob(m[1])}else{h=decodeURIComponent(m[1])}l=new Uint8Array(h.length);for(k=0;k<h.length;k++){l[k]=h.charCodeAt(k)}return l.buffer},arrayBufferToBlob:function(i,k){var j=c.BlobBuilder||c.WebKitBlobBuilder,h;if(j){h=new j();h.append(i);return h.getBlob(k)}return new Blob([i],k?{type:k}:{})},canvasToDataUrl:function(h,j,i){return h.toDataURL(j,i/100)},parseMeta:function(h,i){i(false,{})},updateImageHead:function(h){return h}}});a("runtime/html5/imagemeta",["runtime/html5/util"],function(e){var d;d={parsers:{65505:[]},maxMetaDataSize:262144,parse:function(f,g){var i=this,h=new FileReader();h.onload=function(){g(false,i._parse(this.result));h=h.onload=h.onerror=null};h.onerror=function(j){g(j.message);h=h.onload=h.onerror=null};f=f.slice(0,i.maxMetaDataSize);h.readAsArrayBuffer(f.getSource())},_parse:function(f,n){if(f.byteLength<6){return}var g=new DataView(f),o=2,m=g.byteLength-4,h=o,q={},k,l,p,j;if(g.getUint16(0)===65496){while(o<m){k=g.getUint16(o);if(k>=65504&&k<=65519||k===65534){l=g.getUint16(o+2)+2;if(o+l>g.byteLength){break}p=d.parsers[k];if(!n&&p){for(j=0;j<p.length;j+=1){p[j].call(d,g,o,l,q)}}o+=l;h=o}else{break}}if(h>6){if(f.slice){q.imageHead=f.slice(2,h)}else{q.imageHead=new Uint8Array(f).subarray(2,h)}}}return q},updateImageHead:function(i,k){var j=this._parse(i,true),g,h,f;f=2;if(j.imageHead){f=2+j.imageHead.byteLength}if(i.slice){h=i.slice(f)}else{h=new Uint8Array(i).subarray(f)}g=new Uint8Array(k.byteLength+2+h.byteLength);g[0]=255;g[1]=216;g.set(new Uint8Array(k),2);g.set(new Uint8Array(h),k.byteLength+2);return g.buffer}};e.parseMeta=function(){return d.parse.apply(d,arguments)};e.updateImageHead=function(){return d.updateImageHead.apply(d,arguments)};return d});a("runtime/html5/imagemeta/exif",["base","runtime/html5/imagemeta"],function(d,f){var e={};e.ExifMap=function(){return this};e.ExifMap.prototype.map={Orientation:274};e.ExifMap.prototype.get=function(g){return this[g]||this[this.map[g]]};e.exifTagTypes={1:{getValue:function(h,g){return h.getUint8(g)},size:1},2:{getValue:function(h,g){return String.fromCharCode(h.getUint8(g))},size:1,ascii:true},3:{getValue:function(h,g,i){return h.getUint16(g,i)},size:2},4:{getValue:function(h,g,i){return h.getUint32(g,i)},size:4},5:{getValue:function(h,g,i){return h.getUint32(g,i)/h.getUint32(g+4,i)},size:8},9:{getValue:function(h,g,i){return h.getInt32(g,i)},size:4},10:{getValue:function(h,g,i){return h.getInt32(g,i)/h.getInt32(g+4,i)},size:8}};e.exifTagTypes[7]=e.exifTagTypes[1];e.getExifValue=function(j,r,n,s,l,m){var q=e.exifTagTypes[s],p,h,t,k,o,g;if(!q){d.log("Invalid Exif data: Invalid tag type.");return}p=q.size*l;h=p>4?r+j.getUint32(n+8,m):(n+8);if(h+p>j.byteLength){d.log("Invalid Exif data: Invalid data offset.");return}if(l===1){return q.getValue(j,h,m)}t=[];for(k=0;k<l;k+=1){t[k]=q.getValue(j,h+k*q.size,m)}if(q.ascii){o="";for(k=0;k<t.length;k+=1){g=t[k];if(g==="\u0000"){break}o+=g}return o}return t};e.parseExifTag=function(h,l,j,i,g){var k=h.getUint16(j,i);g.exif[k]=e.getExifValue(h,l,j,h.getUint16(j+2,i),h.getUint32(j+4,i),i)};e.parseExifTags=function(h,o,k,m,g){var n,j,l;if(k+6>h.byteLength){d.log("Invalid Exif data: Invalid directory offset.");return}n=h.getUint16(k,m);j=k+2+12*n;if(j+4>h.byteLength){d.log("Invalid Exif data: Invalid directory size.");return}for(l=0;l<n;l+=1){this.parseExifTag(h,o,k+2+12*l,m,g)}return h.getUint32(j,m)};e.parseExifData=function(h,l,j,g){var m=l+10,k,i;if(h.getUint32(l+4)!==1165519206){return}if(m+8>h.byteLength){d.log("Invalid Exif data: Invalid segment size.");return}if(h.getUint16(l+8)!==0){d.log("Invalid Exif data: Missing byte alignment offset.");return}switch(h.getUint16(m)){case 18761:k=true;break;case 19789:k=false;break;default:d.log("Invalid Exif data: Invalid byte alignment marker.");return}if(h.getUint16(m+2,k)!==42){d.log("Invalid Exif data: Missing TIFF marker.");return}i=h.getUint32(m+4,k);g.exif=new e.ExifMap();i=e.parseExifTags(h,m,m+i,k,g)};f.parsers[65505].push(e.parseExifData);return e});a("runtime/html5/image",["base","runtime/html5/runtime","runtime/html5/util"],function(d,f,g){var e="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D";return f.register("Image",{modified:false,init:function(){var i=this,h=new Image();h.onload=function(){i._info={type:i.type,width:this.width,height:this.height};if(!i._metas&&"image/jpeg"===i.type){g.parseMeta(i._blob,function(j,k){i._metas=k;i.owner.trigger("load")})}else{i.owner.trigger("load")}};h.onerror=function(){i.owner.trigger("error")};i._img=h},loadFromBlob:function(h){var j=this,i=j._img;j._blob=h;j.type=h.type;i.src=g.createObjectURL(h.getSource());j.owner.once("load",function(){g.revokeObjectURL(i.src)})},resize:function(j,i){var h=this._canvas||(this._canvas=document.createElement("canvas"));this._resize(this._img,h,j,i);this._blob=null;this.modified=true;this.owner.trigger("complete")},getAsBlob:function(k){var h=this._blob,j=this.options,i;k=k||this.type;if(this.modified||this.type!==k){i=this._canvas;if(k==="image/jpeg"){h=g.canvasToDataUrl(i,"image/jpeg",j.quality);if(j.preserveHeaders&&this._metas&&this._metas.imageHead){h=g.dataURL2ArrayBuffer(h);h=g.updateImageHead(h,this._metas.imageHead);h=g.arrayBufferToBlob(h,k);return h}}else{h=g.canvasToDataUrl(i,k)}h=g.dataURL2Blob(h)}return h},getAsDataUrl:function(i){var h=this.options;i=i||this.type;if(i==="image/jpeg"){return g.canvasToDataUrl(this._canvas,i,h.quality)}else{return this._canvas.toDataURL(i)}},getOrientation:function(){return this._metas&&this._metas.exif&&this._metas.exif.get("Orientation")||1},info:function(h){if(h){this._info=h;return this}return this._info},meta:function(h){if(h){this._meta=h;return this}return this._meta},destroy:function(){var h=this._canvas;this._img.onload=null;if(h){h.getContext("2d").clearRect(0,0,h.width,h.height);h.width=h.height=0;this._canvas=null}this._img.src=e;this._img=this._blob=null},_resize:function(l,i,s,k){var o=this.options,n=l.width,m=l.height,p=this.getOrientation(),q,r,j,t,u;if(~[5,6,7,8].indexOf(p)){s^=k;k^=s;s^=k}q=Math[o.crop?"max":"min"](s/n,k/m);o.allowMagnify||(q=Math.min(1,q));r=n*q;j=m*q;if(o.crop){i.width=s;i.height=k}else{i.width=r;i.height=j}t=(i.width-r)/2;u=(i.height-j)/2;o.preserveHeaders||this._rotate2Orientaion(i,p);this._renderImageToCanvas(i,l,t,u,r,j)},_rotate2Orientaion:function(h,k){var l=h.width,j=h.height,i=h.getContext("2d");switch(k){case 5:case 6:case 7:case 8:h.width=j;h.height=l;break}switch(k){case 2:i.translate(l,0);i.scale(-1,1);break;case 3:i.translate(l,j);i.rotate(Math.PI);break;case 4:i.translate(0,j);i.scale(1,-1);break;case 5:i.rotate(0.5*Math.PI);i.scale(1,-1);break;case 6:i.rotate(0.5*Math.PI);i.translate(0,-j);break;case 7:i.rotate(0.5*Math.PI);i.translate(l,-j);i.scale(-1,1);break;case 8:i.rotate(-0.5*Math.PI);i.translate(-l,0);break}},_renderImageToCanvas:(function(){if(!d.os.ios){return function(j,l,n,o,m,k){j.getContext("2d").drawImage(l,n,o,m,k)}}function i(p,q,o){var k=document.createElement("canvas"),l=k.getContext("2d"),t=0,n=o,r=o,m,j,s;k.width=1;k.height=o;l.drawImage(p,0,0);m=l.getImageData(0,0,1,o).data;while(r>t){j=m[(r-1)*4+3];if(j===0){n=r}else{t=r}r=(n+t)>>1}s=(r/o);return(s===0)?1:s}if(d.os.ios>=7){return function(j,m,q,r,p,k){var n=m.naturalWidth,l=m.naturalHeight,o=i(m,n,l);return j.getContext("2d").drawImage(m,0,0,n*o,l*o,q,r,p,k)}}function h(m){var n=m.naturalWidth,l=m.naturalHeight,j,k;if(n*l>1024*1024){j=document.createElement("canvas");j.width=j.height=1;k=j.getContext("2d");k.drawImage(m,-n+1,0);return k.getImageData(0,0,1,1).data[3]===0}else{return false}}return function(j,t,E,F,D,r){var u=t.naturalWidth,s=t.naturalHeight,k=j.getContext("2d"),v=h(t),n=this.type==="image/jpeg",l=1024,z=0,q=0,A,B,C,o,m,w,p;if(v){u/=2;s/=2}k.save();A=document.createElement("canvas");A.width=A.height=l;B=A.getContext("2d");C=n?i(t,u,s):1;o=Math.ceil(l*D/u);m=Math.ceil(l*r/s/C);while(z<s){w=0;p=0;while(w<u){B.clearRect(0,0,l,l);B.drawImage(t,-w,-z);k.drawImage(A,0,0,l,l,E+p,F+q,o,m);w+=l;p+=o}z+=l;q+=m}k.restore();A=B=null}})()})});a("runtime/html5/transport",["base","runtime/html5/runtime"],function(e,f){var g=e.noop,d=e.$;return f.register("Transport",{init:function(){this._status=0;this._response=null},send:function(){var m=this.owner,l=this.options,o=this._initAjax(),i=m._blob,n=l.server,j,h,k;if(l.sendAsBinary){n+=(/\?/.test(n)?"&":"?")+d.param(m._formData);h=i.getSource()}else{j=new FormData();d.each(m._formData,function(p,q){j.append(p,q)});j.append(l.fileVal,i.getSource(),l.filename||m._formData.name||"")}if(l.withCredentials&&"withCredentials" in o){o.open(l.method,n,true);o.withCredentials=true}else{o.open(l.method,n)}this._setRequestHeader(o,l.headers);if(h){o.overrideMimeType("application/octet-stream");if(e.os.android){k=new FileReader();k.onload=function(){o.send(this.result);k=k.onload=null};k.readAsArrayBuffer(h)}else{o.send(h)}}else{o.send(j)}},getResponse:function(){return this._response},getResponseAsJson:function(){return this._parseJson(this._response)},getStatus:function(){return this._status},abort:function(){var h=this._xhr;if(h){h.upload.onprogress=g;h.onreadystatechange=g;h.abort();this._xhr=h=null}},destroy:function(){this.abort()},_initAjax:function(){var h=this,j=new XMLHttpRequest(),i=this.options;if(i.withCredentials&&!("withCredentials" in j)&&typeof XDomainRequest!=="undefined"){j=new XDomainRequest()}j.upload.onprogress=function(k){var l=0;if(k.lengthComputable){l=k.loaded/k.total}return h.trigger("progress",l)};j.onreadystatechange=function(){if(j.readyState!==4){return}j.upload.onprogress=g;j.onreadystatechange=g;h._xhr=null;h._status=j.status;if(j.status>=200&&j.status<300){h._response=j.responseText;return h.trigger("load")}else{if(j.status>=500&&j.status<600){h._response=j.responseText;return h.trigger("error","server")}}return h.trigger("error",h._status?"http":"abort")};h._xhr=j;return j},_setRequestHeader:function(i,h){d.each(h,function(j,k){i.setRequestHeader(j,k)})},_parseJson:function(j){var i;try{i=JSON.parse(j)}catch(h){i={}}return i}})});a("preset/html5only",["base","widgets/filednd","widgets/filepaste","widgets/filepicker","widgets/image","widgets/queue","widgets/runtime","widgets/upload","widgets/validator","runtime/html5/blob","runtime/html5/dnd","runtime/html5/filepaste","runtime/html5/filepicker","runtime/html5/imagemeta/exif","runtime/html5/image","runtime/html5/transport"],function(d){return d});a("webuploader",["preset/html5only"],function(d){return d});return b("webuploader")});